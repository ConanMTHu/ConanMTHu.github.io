<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>设计模式(二)之策略模式 | 胡明涛的技术博客</title>
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="爱好电影、音乐和书籍，尤其喜爱许巍、李健及王小波。擅长Java，JavaScript，喜欢用NodeJs编写一些有趣的应用。关注互联网、科技、敏捷开发以及JavaNIO。">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="设计模式(二)之策略模式 | 胡明涛的技术博客">
    <meta name="twitter:description" content="爱好电影、音乐和书籍，尤其喜爱许巍、李健及王小波。擅长Java，JavaScript，喜欢用NodeJs编写一些有趣的应用。关注互联网、科技、敏捷开发以及JavaNIO。">

    <meta property="og:type" content="article">
    <meta property="og:title" content="设计模式(二)之策略模式 | 胡明涛的技术博客">
    <meta property="og:description" content="爱好电影、音乐和书籍，尤其喜爱许巍、李健及王小波。擅长Java，JavaScript，喜欢用NodeJs编写一些有趣的应用。关注互联网、科技、敏捷开发以及JavaNIO。">

    
    <meta name="author" content="Tommy@胡明涛">
    
    <link rel="stylesheet" href="/css/vno.css" type="text/css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" type="text/css">

    
    <link rel="icon" href="/images/favicon.png">
    

    <meta name="generator" content="hexo"/>
    
    <link rel="alternate" type="application/rss+xml" title="胡明涛的技术博客" href="/atom.xml">
    

    <link rel="canonical" href="http://hmttommy.com/2015/04/01/设计模式-二-之策略模式/"/>

    
    <link rel="author" href="https://www.google.com/+LenboMa"/>
    
</head>

<body class="home-template no-js">

    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>

    
<header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/background-cover.jpg)">
  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/" title="前往 胡明涛的技术博客 的主页"><img src="/images/logo2.jpg" width="80" alt="胡明涛的技术博客 logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage for 胡明涛的技术博客">胡明涛的技术博客</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">迷糊小书童</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">Tommy blog iOS Swift</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />

        <div class="navigation-wrapper">
          <div>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="访问博客" class="blog-button">博客</a></li>
            
              <li class="navigation__item"><a href="/projects">项目作品</a></li>
            
              <li class="navigation__item"><a href="/aboutme">关于我</a></li>
            
            </ul>
          </nav>
          </div>
          <div>
          <nav class="cover-navigation navigation--social">
  <ul class="navigation">

  <!-- Weibo-->
  

  <!-- Github -->
  
  <li class="navigation__item">
    <a href="https://github.com/lenbo-ma" title="查看我的GitHub主页" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>


<!-- Stack Overflow -->
        

  <!-- Google Plus -->
  
  <li class="navigation__item">
    <a href="https://www.google.com/+LenboMa" title="Google+" target="_blank">
      <i class='social fa fa-google-plus-square'></i>
      <span class="label">Google+</span>
    </a>
  </li>


<!-- Facebook -->

  <li class="navigation__item">
    <a href="http://www.facebook.com/yang.desheng.me" title="上Facebook找我" target="_blank">
      <i class='social fa fa-facebook'></i>
      <span class="label">Facebook</span>
    </a>
  </li>

  
<!-- Twitter -->

  <li class="navigation__item">
    <a href="https://twitter.com/lenbo_" title="上Twitter找我" target="_blank">
      <i class='social fa fa-twitter'></i>
      <span class="label">Twitter</span>
    </a>
  </li>

  

  <li class="navigation__item">
    <a href="/atom.xml" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>



  </ul>
</nav>

          </div>
        </div>

      </div>

    </div>

    <div class="panel-cover--overlay cover-blue"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single">

  <header class="post-header">
    <div class="post-meta">
      <time datetime="2015-04-01T00:41:23.000Z" class="post-list__meta--date date">2015-04-01</time> &#8226; <span class="post-meta__tags tags">于&nbsp;
  <a class="tag-link" href="/tags/策略/">策略</a>
</span>
    </div>
    <h1 class="post-title">设计模式(二)之策略模式</h1>
  </header>

  <section class="post">
    <h1 id="u521D_u5165_u6C5F_u6E56"><a href="#u521D_u5165_u6C5F_u6E56" class="headerlink" title="初入江湖"></a><font color="IndianRed">初入江湖</font></h1><p><strong>策略模式</strong>：定义一系列的算法,把每一个算法封装起来, 并且使它们可相互替换。本模式使得算法可独立于使用它的客户而变化.<br>0.0好吧,基本上所有介绍策略模式的基本都是这样的开头,详情概念可见<a href="http://baike.baidu.com/link?url=K31Rsj_er4saTaz4l0L69f6YxCMbVTnR9KO007RcP4ymkNGqhvABAtWb3o038qrgLOmVJJOxV08HZVh3HfRTGK" target="_blank" rel="external">策略模式百度百科</a>!博主最初用它,除了善用设计模式优化代码结构之外,最主要的就是消除万恶的<code>if else</code>或<code>switch case</code>(很讨厌<code>if else</code>…在写代码的时候能够用<code>? :</code>就用)<br>话不多说,先来张图(盗的,勿喷,^_^):<br><img src="http://hmtphoto.qiniudn.com/strategy_001.jpg" alt="">  </p>
<h1 id="u5C0F_u8BD5_u624B_u5200"><a href="#u5C0F_u8BD5_u624B_u5200" class="headerlink" title="小试手刀"></a><font color="IndianRed">小试手刀</font></h1><p>我举得栗子概念是<a href="http://casatwy.com/iosying-yong-jia-gou-tan-viewceng-de-zu-zhi-he-diao-yong-fang-an.html" target="_blank" rel="external">iOS应用架构谈 view层的组织和调用方案</a>(<strong>强烈推荐此文,很长但是涉及到了很多知识点</strong>)中谈到的文件<code>聊天应用的消息发送模块</code>  </p>
<ul>
<li>定义一个<code>Context</code>类,里面有一个<code>RootStrategy</code>属性  <figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">enum MessageSendStrategyType &#123;</span><br><span class="line">    case Text</span><br><span class="line">    case Image</span><br><span class="line">    case Voice</span><br><span class="line">    case Video</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="label">class StrategyContext:</span> NSObject &#123; </span><br><span class="line"><span class="label">    var strategy:</span> RootStrategy?</span><br><span class="line">    // oc 则是 [TextSendStrategy class]....</span><br><span class="line"><span class="label">    let strategyClassDic: [MessageSendStrategyType : AnyClass] = [MessageSendStrategyType.Text : TextSendStrategy.self, .Image : ImageStrategy.self, .Voice : VoiceStrategy.self, .Video :</span> VideoStrategy.self]<span class="comment">;</span></span><br><span class="line">    </span><br><span class="line"><span class="label">//    let strategyStringDic: [MessageSendStrategyType : String] = [MessageSendStrategyType.Text :</span> <span class="string">"StrategyMode.TextSendStrategy"</span>, .Image : <span class="string">"StrategyMode.ImageStrategy"</span>, .Voice : <span class="string">"StrategyMode.VoiceStrategy"</span>, .Video : <span class="string">"StrategyMode.VideoStrategy"</span>]<span class="comment">;</span></span><br><span class="line"></span><br><span class="line"><span class="label">    init(messageType :</span> MessageSendStrategyType) &#123;</span><br><span class="line"><span class="label">        let strategyClassClass:</span> AnyClass? = strategyClassDic[messageType]</span><br><span class="line">        strategy = (strategyClassClass! as! RootStrategy.Type)()</span><br><span class="line">        </span><br><span class="line"><span class="label">//        let strategyStringClass:</span> AnyClass! = NSClassFromString(strategyStringDic[messageType]!)</span><br><span class="line">//        self.strategy = (strategyStringClass as! RootStrategy.Type).new()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    func contextInterface() &#123;</span><br><span class="line">        strategy!.run()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="escape">``</span><span class="escape">` </span> </span><br><span class="line"><span class="number">1</span>.定义一个<span class="escape">`M</span>essageSendStrategyType<span class="escape">`枚</span>举<span class="escape">`+</span><span class="escape">`反</span>射,解决内部/外部的<span class="escape">`s</span>witch case<span class="escape">`的</span>构建工厂(见工厂模式)判断  </span><br><span class="line"><span class="number">2</span>.给字典赋值的两种方式都行,但注意调用<span class="escape">`N</span>SClassFromString<span class="escape">`的</span>时候有坑,单纯的传<span class="escape">`类</span>名<span class="escape">`无</span>效,需要加上你的工程名,我的工程名是<span class="escape">`S</span>trategyMode<span class="escape">`,</span>那就必须是<span class="escape">`N</span>SClassFromString(StrategyMode.xxxx)<span class="escape">`才</span>行!!!  </span><br><span class="line"><span class="number">3</span>.调用<span class="escape">`n</span>ew()<span class="escape">`和</span><span class="escape">`(</span>)<span class="escape">`初</span>始化是不一样的,后面会给出说明  </span><br><span class="line"> &lt;!--more--&gt;  </span><br><span class="line">  </span><br><span class="line">- 接着定义<span class="escape">`R</span>ootStrategy<span class="escape">`,</span>也就是所有<span class="escape">`算</span>法<span class="escape">`的</span>父类/公共接口</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>@objc protocol SendFunctionDelegate: NSObjectProtocol {<br>    func strategyMsg()<br>    optional func sendReadyData()<br>    optional func uploadRequest(name: String?) -&gt; String?<br>    optional func uploadResource(id: String?, data: NSData?) -&gt; String?<br>    optional func otherMethod_A()<br>    optional func otherMethod_B()<br>}</p>
<p>class RootStrategy: NSObject{</p>
<pre><code>var delegate: SendFunctionDelegate?
required  override init() {
}
/**
*   多态的体现,父类的这个方法必须要子类去覆重,可以不写在接口,直接定义为父类的方法
*   不过这里通过IOP,定义这类方法为`required`必须实现的
*   这里通过接口方式而不是全部多态(好纠结,我表示运用的不熟练吧,反正我自己也没能完全说服自己)
*   总感觉试验失败了,囧!!!
*/
// 被我改来改去,达到所谓的消除父类的空方法....
func run() {
    self.delegate!.strategyMsg()
}
</code></pre><p>//    如果不实现strategyMsg(),就会报错,无法调用<br>//    func run() {<br>//        delegate!.strategyMsg()<br>//    }<br>}</p>
<p>/** 喵神的tip里面说到了 为什么要添加这样一个初始化方法</p>
<ul>
<li>单单是这样还是无法通过编译,编译器提示我们如果想要构建一个 Self 类型的对象的话,需要有 required 关键字修饰的初始化方 法,这是因为 Swift 必须保证 当前类和其子类都能响应这个 init 方法</li>
<li>required 要求必须要实现,但又因为init()是默认的构造器,子类会默认实现并且默认调用,required的关键就是会强制调用默认构造器<br>*/</li>
</ul>
<p>/**</p>
<ul>
<li>不过,如果你在Context中的初始化是用了<code>new()</code>就不需要实现下面方法</li>
<li>官方文档: This method is a combination of alloc and init. Like alloc, it initializes the isa instance variable of the new object so it points to the class data structure. It then invokes the init method to complete the initialization process.</li>
<li><p>所以,不需要你强制,子类也一定会做<code>init()</code>操作<br>*/<br>//    required override init() {<br>//<br>//    }</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PS:这里也踩了很多坑<span class="attribute">...</span>一直在试验我前面提到文章里面说的<span class="string">`接口代替继承`</span>,貌似没成功,swift中对于<span class="string">`protocol`</span>和oc中有那么点不一样<span class="attribute">...</span>反正写乱了<span class="attribute">...</span>还是直接把方法直接写父类吧<span class="attribute">...</span>  </span><br><span class="line">  </span><br><span class="line">  - 然后就是<span class="string">`Strategy`</span>的具体实现了,如<span class="string">`TextSendStrategy`</span> <span class="string">`ImageStrategy`</span>  <span class="string">`VoiceStrategy`</span>  <span class="string">`VideoStrategy`</span>,暂举<span class="number">2</span>个栗子:</span><br></pre></td></tr></table></figure>
<p>// 文本<br>class TextSendStrategy: RootStrategy,SendFunctionDelegate {<br>required  init() {</p>
<pre><code>super.init()
self.delegate = self
</code></pre><p>}</p>
<p>func strategyMsg() {</p>
<pre><code>sendReadyData()
</code></pre><p>}</p>
<p>func sendReadyData() {</p>
<pre><code>println(&quot;文本消息,直接发送&quot;)
</code></pre><p>}<br>}</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> </span><br></pre></td></tr></table></figure>
<p>// 图片<br>class ImageStrategy: RootStrategy,SendFunctionDelegate {</p>
<p>required  init() {</p>
<pre><code>super.init()
self.delegate = self
</code></pre><p>}</p>
<p> func strategyMsg() {</p>
<pre><code>let id = uploadRequest(&quot;123456&quot;)
let url = uploadResource(id, data: nil)
sendReadyData()
</code></pre><p>}</p>
<p>func uploadRequest(name: String?) -&gt; String? {</p>
<pre><code>println(&quot;ID申请好了&quot;)
return &quot;ID&quot;
</code></pre><p>}</p>
<p>func uploadResource(id: String?, data: NSData?) -&gt; String? {</p>
<pre><code>println(&quot;URL也得到了&quot;)
return &quot;URL&quot;
</code></pre><p>}</p>
<p>func  sendReadyData() {</p>
<pre><code>println(&quot;可以发送图片了&quot;)
</code></pre><p>}<br>}</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="code"> </span></span><br><span class="line"><span class="code"> </span></span><br><span class="line"><span class="bullet">- </span>最后调用</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>override func viewDidLoad() {<br>        super.viewDidLoad()<br>        // Do any additional setup after loading the view, typically from a nib.<br>        // video,text,voice,image随便传,要什么传什么<br>        let context = StrategyContext(messageType: .Image)<br>        context.contextInterface()</p>
<pre><code>}
</code></pre><p>```  </p>
<h1 id="u5C0F_u529F_u544A_u6210"><a href="#u5C0F_u529F_u544A_u6210" class="headerlink" title="小功告成"></a><font color="IndianRed">小功告成</font></h1><p>一个简单的策略模式Demo,基本就这样完成了.这样,是不是,即使存在各种类型的数据发送判断,也没有出现一个<code>if else</code>或<code>switch case</code>呀!<br>LZ最近的两个项目里面都用到了:<br>一是.文件传送,接受来自底层返回的各种类型数据,需要对应各自的数据处理方法<br>二是.网络请求,同栗子….</p>

  </section>

</article>



            <footer class="footer">
    <span class="footer__copyright">
        本站点采用<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>
    </span>
    <span class="footer__copyright">
        基于 <a href="http://hexo.io">Hexo</a> 搭建，感谢 <a href="https://pages.github.com/">GitHub Pages</a> 提供免费的托管服务
    </span>
    <span class="footer__copyright">
        &copy; 2016 - 本站由 <a href="/">@Longbo Ma</a> 创建,
        使用<a href="https://github.com/lenbo-ma/hexo-theme-vno">hexo-theme-vno</a>主题,
        修改自<a href="http://github.com/onevcat/vno" target="_blank">Vno</a>
    </span>
</footer>

        </div>
    </div>

    <script src="http://cdn.bootcss.com/jquery/2.1.4/jquery.min.js" type="text/javascript"></script>
    <script src="/js/main.js" type="text/javascript"></script>

     
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-42596364-1', 'auto');
	ga('send', 'pageview');
</script>

</body>
</html>
