<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>设计模式(二)之策略模式 | 胡明涛的技术博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="初入江湖策略模式：定义一系列的算法,把每一个算法封装起来, 并且使它们可相互替换。本模式使得算法可独立于使用它的客户而变化.0.0好吧,基本上所有介绍策略模式的基本都是这样的开头,详情概念可见策略模式百度百科!博主最初用它,除了善用设计模式优化代码结构之外,最主要的就是消除万恶的if else或switch case(很讨厌if else…在写代码的时候能够用? :就用)话不多说,先来张图(盗的,">
<meta property="og:type" content="article">
<meta property="og:title" content="设计模式(二)之策略模式">
<meta property="og:url" content="http://hmttommy.com/2015/04/01/设计模式-二-之策略模式/index.html">
<meta property="og:site_name" content="胡明涛的技术博客">
<meta property="og:description" content="初入江湖策略模式：定义一系列的算法,把每一个算法封装起来, 并且使它们可相互替换。本模式使得算法可独立于使用它的客户而变化.0.0好吧,基本上所有介绍策略模式的基本都是这样的开头,详情概念可见策略模式百度百科!博主最初用它,除了善用设计模式优化代码结构之外,最主要的就是消除万恶的if else或switch case(很讨厌if else…在写代码的时候能够用? :就用)话不多说,先来张图(盗的,">
<meta property="og:image" content="http://hmtphoto.qiniudn.com/strategy_001.jpg">
<meta property="og:updated_time" content="2016-01-22T02:53:50.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="设计模式(二)之策略模式">
<meta name="twitter:description" content="初入江湖策略模式：定义一系列的算法,把每一个算法封装起来, 并且使它们可相互替换。本模式使得算法可独立于使用它的客户而变化.0.0好吧,基本上所有介绍策略模式的基本都是这样的开头,详情概念可见策略模式百度百科!博主最初用它,除了善用设计模式优化代码结构之外,最主要的就是消除万恶的if else或switch case(很讨厌if else…在写代码的时候能够用? :就用)话不多说,先来张图(盗的,">
  
    <link rel="alternative" href="/atom.xml" title="胡明涛的技术博客" type="application/atom+xml">
  
  
    <link rel="icon" href="http://7qn7zn.com1.z0.glb.clouddn.com/海贼2.jpg">
  
  
  <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <script>
      var yiliaConfig = {
          fancybox: true,
          animate: true,
          isHome: false,
          isPost: true,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            
            <img lazy-src="http://7qn7zn.com1.z0.glb.clouddn.com/hmt.png" class="js-avatar">
            
        </a>

        <hgroup>
          <h1 class="header-author"><a href="/">Tommy@迷糊小书童</a></h1>
        </hgroup>

        
        <p class="header-subtitle">talk is cheap, show me your code</p>
        
                


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <li id="Email"><a class="Email" target="_blank" href="/tommyyaphetshu@163.com" title="Email"></a></li>
                            
                                <li id="新浪微博"><a class="新浪微博" target="_blank" href="http://weibo.com/3356618724/profile?rightmod=1&wvr=6&mod=personinfo" title="新浪微博"></a></li>
                            
                                <li id="GitHub"><a class="GitHub" target="_blank" href="https://github.com/ConanMTHu" title="GitHub"></a></li>
                            
                                <li id="Google"><a class="Google" target="_blank" href="https://www.google.com/?hl=zh-cn&gws_rd=ssl" title="Google"></a></li>
                            
                                <li id="Twitter"><a class="Twitter" target="_blank" href="https://twitter.com/" title="Twitter"></a></li>
                            
                                <li id="LinkedIn"><a class="LinkedIn" target="_blank" href="http://blog.csdn.net/hmt20130412" title="LinkedIn"></a></li>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/AVFoundation-二维码/" style="font-size: 10px;">AVFoundation 二维码</a> <a href="/tags/About-Me/" style="font-size: 10px;">About Me</a> <a href="/tags/AutoLayout/" style="font-size: 10px;">AutoLayout</a> <a href="/tags/Basic-KeyFrame/" style="font-size: 10px;">Basic KeyFrame</a> <a href="/tags/CAAnimation-CAMediaTiming/" style="font-size: 10px;">CAAnimation CAMediaTiming</a> <a href="/tags/CATransition/" style="font-size: 10px;">CATransition</a> <a href="/tags/Category-closure-objc-set-get/" style="font-size: 10px;">Category closure objc_set/get</a> <a href="/tags/Swift和OC互调用/" style="font-size: 10px;">Swift和OC互调用</a> <a href="/tags/Today/" style="font-size: 10px;">Today</a> <a href="/tags/hit-test/" style="font-size: 10px;">hit-test</a> <a href="/tags/imageView-性能优化/" style="font-size: 10px;">imageView 性能优化</a> <a href="/tags/json-model/" style="font-size: 10px;">json model</a> <a href="/tags/network-request/" style="font-size: 10px;">network request</a> <a href="/tags/new-origin/" style="font-size: 10px;">new origin</a> <a href="/tags/pop/" style="font-size: 10px;">pop</a> <a href="/tags/protocol-MVVM-Mixins-Traits-composition/" style="font-size: 10px;">protocol MVVM Mixins Traits composition</a> <a href="/tags/tableview-cell/" style="font-size: 10px;">tableview cell</a> <a href="/tags/xctool/" style="font-size: 10px;">xctool</a> <a href="/tags/单例/" style="font-size: 10px;">单例</a> <a href="/tags/图片浏览-Custom-push/" style="font-size: 10px;">图片浏览 Custom push</a> <a href="/tags/基本概念/" style="font-size: 10px;">基本概念</a> <a href="/tags/基础动画-UIKit封装/" style="font-size: 10px;">基础动画 UIKit封装</a> <a href="/tags/宏-小技巧/" style="font-size: 10px;">宏 小技巧</a> <a href="/tags/小技巧/" style="font-size: 10px;">小技巧</a> <a href="/tags/策略/" style="font-size: 10px;">策略</a> <a href="/tags/适配-AutoLayout/" style="font-size: 10px;">适配 AutoLayout</a> <a href="/tags/链接-blog/" style="font-size: 10px;">链接 blog</a> <a href="/tags/链接-github-Demo/" style="font-size: 10px;">链接 github Demo</a> <a href="/tags/面试题/" style="font-size: 10px;">面试题</a>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">相信coding能够改变世界的IT爱好者</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Tommy@迷糊小书童</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img lazy-src="http://7qn7zn.com1.z0.glb.clouddn.com/hmt.png" class="js-avatar">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Tommy@迷糊小书童</a></h1>
            </hgroup>
            
            <p class="header-subtitle">talk is cheap, show me your code</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <li id="Email"><a class="Email" target="_blank" href="/tommyyaphetshu@163.com" title="Email"></a></li>
                            
                                <li id="新浪微博"><a class="新浪微博" target="_blank" href="http://weibo.com/3356618724/profile?rightmod=1&wvr=6&mod=personinfo" title="新浪微博"></a></li>
                            
                                <li id="GitHub"><a class="GitHub" target="_blank" href="https://github.com/ConanMTHu" title="GitHub"></a></li>
                            
                                <li id="Google"><a class="Google" target="_blank" href="https://www.google.com/?hl=zh-cn&gws_rd=ssl" title="Google"></a></li>
                            
                                <li id="Twitter"><a class="Twitter" target="_blank" href="https://twitter.com/" title="Twitter"></a></li>
                            
                                <li id="LinkedIn"><a class="LinkedIn" target="_blank" href="http://blog.csdn.net/hmt20130412" title="LinkedIn"></a></li>
                            
                        </ul>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap"><article id="post-设计模式-二-之策略模式" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/04/01/设计模式-二-之策略模式/" class="article-date">
      <time datetime="2015-04-01T00:41:23.000Z" itemprop="datePublished">2015-04-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      设计模式(二)之策略模式
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/设计模式/">设计模式</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/策略/">策略</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="u521D_u5165_u6C5F_u6E56"><a href="#u521D_u5165_u6C5F_u6E56" class="headerlink" title="初入江湖"></a><font color="IndianRed">初入江湖</font></h2><p><strong>策略模式</strong>：定义一系列的算法,把每一个算法封装起来, 并且使它们可相互替换。本模式使得算法可独立于使用它的客户而变化.<br>0.0好吧,基本上所有介绍策略模式的基本都是这样的开头,详情概念可见<a href="http://baike.baidu.com/link?url=K31Rsj_er4saTaz4l0L69f6YxCMbVTnR9KO007RcP4ymkNGqhvABAtWb3o038qrgLOmVJJOxV08HZVh3HfRTGK" target="_blank" rel="external">策略模式百度百科</a>!博主最初用它,除了善用设计模式优化代码结构之外,最主要的就是消除万恶的<code>if else</code>或<code>switch case</code>(很讨厌<code>if else</code>…在写代码的时候能够用<code>? :</code>就用)<br>话不多说,先来张图(盗的,勿喷,^_^):<br><img src="http://hmtphoto.qiniudn.com/strategy_001.jpg" alt="">  </p>
<h2 id="u5C0F_u8BD5_u624B_u5200"><a href="#u5C0F_u8BD5_u624B_u5200" class="headerlink" title="小试手刀"></a><font color="IndianRed">小试手刀</font></h2><p>我举得栗子概念是<a href="http://casatwy.com/iosying-yong-jia-gou-tan-viewceng-de-zu-zhi-he-diao-yong-fang-an.html" target="_blank" rel="external">iOS应用架构谈 view层的组织和调用方案</a>(<strong>强烈推荐此文,很长但是涉及到了很多知识点</strong>)中谈到的文件<code>聊天应用的消息发送模块</code>  </p>
<ul>
<li>定义一个<code>Context</code>类,里面有一个<code>RootStrategy</code>属性</li>
</ul>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">enum</span> MessageSendStrategyType &#123;</span><br><span class="line">    case Text</span><br><span class="line">    case Image</span><br><span class="line">    case Voice</span><br><span class="line">    case Video</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="label">class</span> <span class="keyword">StrategyContext: </span>NSObject &#123; </span><br><span class="line">    var <span class="keyword">strategy: </span>RootStrategy?</span><br><span class="line">    // oc 则是 [TextSendStrategy class]....</span><br><span class="line">    let <span class="keyword">strategyClassDic: </span>[MessageSendStrategyType : AnyClass] = [MessageSendStrategyType<span class="preprocessor">.Text</span> : TextSendStrategy.<span class="keyword">self, </span>.Image : ImageStrategy.<span class="keyword">self, </span>.Voice : VoiceStrategy.<span class="keyword">self, </span>.Video : VideoStrategy.<span class="keyword">self];</span><br><span class="line"></span>    </span><br><span class="line">//    let <span class="keyword">strategyStringDic: </span>[MessageSendStrategyType : <span class="keyword">String] </span>= [MessageSendStrategyType<span class="preprocessor">.Text</span> : <span class="string">"StrategyMode.TextSendStrategy"</span>, .Image : <span class="string">"StrategyMode.ImageStrategy"</span>, .Voice : <span class="string">"StrategyMode.VoiceStrategy"</span>, .Video : <span class="string">"StrategyMode.VideoStrategy"</span>]<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">    init(messageType : MessageSendStrategyType) &#123;</span><br><span class="line">        let <span class="keyword">strategyClassClass: </span>AnyClass? = <span class="keyword">strategyClassDic[messageType]</span><br><span class="line"></span>        <span class="keyword">strategy </span>= (<span class="keyword">strategyClassClass! </span>as! RootStrategy.Type)()</span><br><span class="line">        </span><br><span class="line">//        let <span class="keyword">strategyStringClass: </span>AnyClass! = NSClassFromString(<span class="keyword">strategyStringDic[messageType]!)</span><br><span class="line"></span>//        <span class="keyword">self.strategy </span>= (<span class="keyword">strategyStringClass </span>as! RootStrategy.Type).new()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    func contextInterface() &#123;</span><br><span class="line">        <span class="keyword">strategy!.run()</span><br><span class="line"></span>    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1.定义一个<code>MessageSendStrategyType</code>枚举<code>+</code>反射,解决内部/外部的<code>switch case</code>的构建工厂(见工厂模式)判断<br>2.给字典赋值的两种方式都行,但注意调用<code>NSClassFromString</code>的时候有坑,单纯的传<code>类名</code>无效,需要加上你的工程名,我的工程名是<code>StrategyMode</code>,那就必须是<code>NSClassFromString(StrategyMode.xxxx)</code>才行!!!<br>3.调用<code>new()</code>和<code>()</code>初始化是不一样的,后面会给出说明<br> <a id="more"></a>  </p>
<ul>
<li>接着定义<code>RootStrategy</code>,也就是所有<code>算法</code>的父类/公共接口</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">@objc</span> <span class="class"><span class="keyword">protocol</span> <span class="title">SendFunctionDelegate</span>: <span class="title">NSObjectProtocol</span> </span>&#123;</span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">strategyMsg</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">optional</span> <span class="func"><span class="keyword">func</span> <span class="title">sendReadyData</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">optional</span> <span class="func"><span class="keyword">func</span> <span class="title">uploadRequest</span><span class="params">(name: String?)</span></span> -&gt; <span class="type">String</span>?</span><br><span class="line">    <span class="keyword">optional</span> <span class="func"><span class="keyword">func</span> <span class="title">uploadResource</span><span class="params">(id: String?, data: NSData?)</span></span> -&gt; <span class="type">String</span>?</span><br><span class="line">    <span class="keyword">optional</span> <span class="func"><span class="keyword">func</span> <span class="title">otherMethod_A</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">optional</span> <span class="func"><span class="keyword">func</span> <span class="title">otherMethod_B</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RootStrategy</span>: <span class="title">NSObject</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> delegate: <span class="type">SendFunctionDelegate</span>?</span><br><span class="line">    <span class="keyword">required</span>  <span class="keyword">override</span> <span class="keyword">init</span>() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    *   多态的体现,父类的这个方法必须要子类去覆重,可以不写在接口,直接定义为父类的方法</span><br><span class="line">    *   不过这里通过IOP,定义这类方法为`required`必须实现的</span><br><span class="line">    *   这里通过接口方式而不是全部多态(好纠结,我表示运用的不熟练吧,反正我自己也没能完全说服自己)</span><br><span class="line">    *   总感觉试验失败了,囧!!!</span><br><span class="line">    */</span></span><br><span class="line">    <span class="comment">// 被我改来改去,达到所谓的消除父类的空方法....</span></span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.delegate!.strategyMsg()</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//    如果不实现strategyMsg(),就会报错,无法调用</span></span><br><span class="line"><span class="comment">//    func run() &#123;</span></span><br><span class="line"><span class="comment">//        delegate!.strategyMsg()</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 喵神的tip里面说到了 为什么要添加这样一个初始化方法</span><br><span class="line">*  单单是这样还是无法通过编译,编译器提示我们如果想要构建一个 Self 类型的对象的话,需要有 required 关键字修饰的初始化方 法,这是因为 Swift 必须保证 当前类和其子类都能响应这个 init 方法</span><br><span class="line">*   required 要求必须要实现,但又因为init()是默认的构造器,子类会默认实现并且默认调用,required的关键就是会强制调用默认构造器</span><br><span class="line">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">*  不过,如果你在Context中的初始化是用了`new()`就不需要实现下面方法</span><br><span class="line">*   官方文档: This method is a combination of alloc and init. Like alloc, it initializes the isa instance variable of the new object so it points to the class data structure. It then invokes the init method to complete the initialization process.</span><br><span class="line">*   所以,不需要你强制,子类也一定会做`init()`操作</span><br><span class="line">*/</span></span><br><span class="line"><span class="comment">//    required override init() &#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br></pre></td></tr></table></figure>
<p>PS:这里也踩了很多坑…一直在试验我前面提到文章里面说的<code>接口代替继承</code>,貌似没成功,swift中对于<code>protocol</code>和oc中有那么点不一样…反正写乱了…还是直接把方法直接写父类吧…  </p>
<ul>
<li><p>然后就是<code>Strategy</code>的具体实现了,如<code>TextSendStrategy</code> <code>ImageStrategy</code>  <code>VoiceStrategy</code>  <code>VideoStrategy</code>,暂举2个栗子:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// 文本</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">TextSendStrategy</span>: <span class="title">RootStrategy</span>,<span class="title">SendFunctionDelegate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">required</span>  <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">        <span class="keyword">self</span>.delegate = <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">strategyMsg</span><span class="params">()</span></span> &#123;</span><br><span class="line">        sendReadyData()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">sendReadyData</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"文本消息,直接发送"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 图片  </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageStrategy</span>: <span class="title">RootStrategy</span>,<span class="title">SendFunctionDelegate</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">required</span>  <span class="keyword">init</span>() &#123;</span><br><span class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</span><br><span class="line">        <span class="keyword">self</span>.delegate = <span class="keyword">self</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">     <span class="func"><span class="keyword">func</span> <span class="title">strategyMsg</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">let</span> id = uploadRequest(<span class="string">"123456"</span>)</span><br><span class="line">        <span class="keyword">let</span> url = uploadResource(id, data: <span class="literal">nil</span>)</span><br><span class="line">        sendReadyData()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">uploadRequest</span><span class="params">(name: String?)</span></span> -&gt; <span class="type">String</span>? &#123;</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"ID申请好了"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"ID"</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">uploadResource</span><span class="params">(id: String?, data: NSData?)</span></span> -&gt; <span class="type">String</span>? &#123;</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"URL也得到了"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"URL"</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="func"><span class="keyword">func</span>  <span class="title">sendReadyData</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="built_in">println</span>(<span class="string">"可以发送图片了"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>最后调用</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        <span class="comment">// Do any additional setup after loading the view, typically from a nib.</span></span><br><span class="line">        <span class="comment">// video,text,voice,image随便传,要什么传什么</span></span><br><span class="line">        <span class="keyword">let</span> context = <span class="type">StrategyContext</span>(messageType: .<span class="type">Image</span>)</span><br><span class="line">        context.contextInterface()</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h2 id="u5C0F_u529F_u544A_u6210"><a href="#u5C0F_u529F_u544A_u6210" class="headerlink" title="小功告成"></a><font color="IndianRed">小功告成</font></h2><p>一个简单的策略模式Demo,基本就这样完成了.这样,是不是,即使存在各种类型的数据发送判断,也没有出现一个<code>if else</code>或<code>switch case</code>呀!<br>LZ最近的两个项目里面都用到了:<br>一是.文件传送,接受来自底层返回的各种类型数据,需要对应各自的数据处理方法<br>二是.网络请求,同栗子….</p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2015/04/01/设计模式-二-之策略模式/">设计模式(二)之策略模式</a></p>
        <p><span>文章作者:</span><a href="/" title="访问 Tommy@迷糊小书童 的个人博客">Tommy@迷糊小书童</a></p>
        <p><span>发布时间:</span>2015年04月01日 - 08时41分</p>
        <p><span>最后更新:</span>2016年01月22日 - 10时53分</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2015/04/01/设计模式-二-之策略模式/" title="设计模式(二)之策略模式">http://hmttommy.com/2015/04/01/设计模式-二-之策略模式/</a>
            <span class="copy-path" data-clipboard-text="原文: http://hmttommy.com/2015/04/01/设计模式-二-之策略模式/　　作者: Tommy@迷糊小书童" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script src="/js/clipboard.min.js"></script>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)" target = "_blank">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2015/04/14/AutolayoutDetail/">
                    Autolayout优秀的第三方开源库
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2015/03/21/iOS面试题总结与感想/">
                    iOS面试题总结与感想
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#u521D_u5165_u6C5F_u6E56"><span class="toc-number">1.</span> <span class="toc-text">初入江湖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u5C0F_u8BD5_u624B_u5200"><span class="toc-number">2.</span> <span class="toc-text">小试手刀</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u5C0F_u529F_u544A_u6210"><span class="toc-number">3.</span> <span class="toc-text">小功告成</span></a></li></ol>
</div>
<style>
    .left-col .switch-btn {
        display: none;
    }
    .left-col .switch-area {
        display: none;
    }
</style>

<input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script>
    var valueHide = "隐藏目录";
    var valueShow = "显示目录";

    if ($(".left-col").is(":hidden")) {
        $("#tocButton").attr("value", valueShow);
    }

    $("#tocButton").click(function() {
        if ($("#toc").is(":hidden")) {
            $("#tocButton").attr("value", valueHide);
            $("#toc").slideDown(320);
            $(".switch-btn, .switch-area").fadeOut(300);
        }
        else {
            $("#tocButton").attr("value", valueShow);
            $("#toc").slideUp(350);
            $(".switch-btn, .switch-area").fadeIn(500);
        }
    })

    if ($(".toc").length < 1) {
        $("#toc, #tocButton").hide();
        $(".switch-btn, .switch-area").show();
    }
</script>




<div class="share">
    <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
    <a href="#" class="bds_copy" data-cmd="copy" title="复制网址"></a>
    <a href="#" class="bds_mail" data-cmd="mail" title="通过邮件分享"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
    </div>
    <script>
        window._bd_share_config={
            "common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
    </script>
</div>



 
      <div class="duoshuo" id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="2015/04/01/设计模式-二-之策略模式/" data-title="设计模式(二)之策略模式" data-url="http://hmttommy.com/2015/04/01/设计模式-二-之策略模式/"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"humingtao"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
    <!-- 多说公共JS代码 end -->
</div>

    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2015/04/14/AutolayoutDetail/" title="上一篇: Autolayout优秀的第三方开源库">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2015/03/21/iOS面试题总结与感想/" title="下一篇: iOS面试题总结与感想">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/01/22/UIScrollView汇总-持续更新/">UIScrollView汇总-持续更新</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/01/14/protocolMVVM/">Swift 面向Protocol编程浅析:Inheritence-Composition-Protocol</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/21/UIScrollViewAndUIImageView/">UIScrollView展示图片的三次升级</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/15/Moya/">Swift Moya</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/12/11/AddCategoryProperty/">Swift Closure与AnyObject在Extension中的转换</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/29/swiftjson/">SwiftyJson + ObjectMapper + Argo</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/26/facebookpop/">Facebook POP使用介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/15/TheSinInSingleton/">设计模式(三)之单例模式(译)</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/06/基于项目某处图片浏览需求引发的蛋疼/">基于项目某处图片浏览需求引发的XX</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/04/iOS-CoreAnimation-04/">iOS CoreAnimation(四)之CAPropertyAnimation</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/22/iOS开发过程中的知识点总结-续/">iOS开发过程中的知识点总结(续)</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/16/xctool-xcodebuild自动打包傻瓜式教程/">xctool+xcodebuild自动打包傻瓜式教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/10/12/Star-Github-share/">Star Github share</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/06/03/iOS-CoreAnimation-三-之CAAnimation/">iOS CoreAnimation(三)之CAAnimation</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/29/iOS-CoreAnimation-02/">iOS CoreAnimation(二)之CATransition</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/27/iOS-CoreAnimation-01/">iOS CoreAnimation(一)之UIKit封装的UIView动画</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/05/25/iOS-hitTest/">iOS hitTest-点击事件分发分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/04/14/AutolayoutDetail/">Autolayout优秀的第三方开源库</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/04/01/设计模式-二-之策略模式/">设计模式(二)之策略模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/03/21/iOS面试题总结与感想/">iOS面试题总结与感想</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/03/16/Swift-AVFoundation-二维码扫描和生成/">Swift AVFoundation 二维码扫描和生成</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/02/26/Swift从零单排系列-一-之宏替换与代码标识/">Swift 宏替换与代码标识</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/02/20/Swift从零单排系列-零-之官方文档读书笔记/">Swift 官方文档读书笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/02/19/2014终-2015新年寄语/">2014终,2015新年寄语</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/01/06/Swift和Objective-C的互用/">Swift和Objective-C的互用</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/12/08/自适应Cell的两种方式/">自适应Cell的两种方式</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/12/05/AutoLayout/">iOS8 AutoLayout与Size Class 自悟</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/12/04/blogData/">收藏的iOS技术网站汇总(持续更新ing)</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/11/02/widget/">iOS8 Today 实现Clips widget</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/11/02/new-start/">新的开始</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/10/01/hello-world/">Hello World</a></li></ul>
    <script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
    <script>
        $(".post-list").addClass("toc-article");
        $(".post-list-item a").attr("target","_blank");
        $("#post-nav-button > a:nth-child(2)").click(function() {
            $(".fa-bars, .fa-times").toggle();
            $(".post-list").toggle(300);
            if ($(".toc").length > 0) {
                $("#toc, #tocButton").toggle(200, function() {
                    if ($(".switch-area").is(":visible")) {
                        $("#toc, .switch-btn, .switch-area").toggle();
                        $("#tocButton").attr("value", valueHide);
                        }
                    })
            }
            else {
                $(".switch-btn, .switch-area").fadeToggle(300);
            }
        })
    </script>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2016 Tommy@迷糊小书童
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的静态博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减双栏 Hexo 博客主题">Yelee</a> by MOxFIVE
            </div>
        </div>
        <div class="visit">
            <span id="busuanzi_container_site_pv" style='display:none'>
                <span id="site-visit" >本站到访数: 
                    <span id="busuanzi_value_site_uv"></span>
                </span>
            </span>
            <span id="busuanzi_container_page_pv" style='display:none'>
                <span id="page-visit">, 本页阅读量: 
                    <span id="busuanzi_value_page_pv"></span>
                </span>
            </span>
        </div>
    </div>
</footer>
    </div>
    <script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>


<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-72551550-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>

<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>